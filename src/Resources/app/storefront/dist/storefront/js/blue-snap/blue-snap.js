(()=>{"use strict";let e=new class{async _makeRequest(e,t,a){let r=new Headers;r.append("Content-Type","application/json");let n={method:t,headers:r};a&&(n.body=JSON.stringify(a));try{let t=await fetch(e,n);return await t.json()}catch(e){console.log(JSON.stringify(e,null,2))}}constructor(){this.endpoints={capture:async e=>await this._makeRequest("/capture","POST",e),googleCapture:async e=>await this._makeRequest("/google-capture","POST",e),appleCreateWallet:async e=>await this._makeRequest("/apple-create-wallet","POST",e),appleCapture:async e=>await this._makeRequest("/apple-capture","POST",e),vaultedShopper:async e=>await this._makeRequest("/vaulted-shopper","POST",e),updateVaultedShopper:async(e,t)=>await this._makeRequest("/update-vaulted-shopper/"+e,"PUT",t)}}}().endpoints;class t extends window.PluginBaseClass{init(){this._registerElements(),this._registerEvents(),this._showForm()}_registerElements(){var e;this.confirmOrderForm=document.forms[this.options.confirmFormId],this.parentCreditCardWrapper=document.getElementById(this.options.parentCreditCardWrapperId),this.pfToken=this.parentCreditCardWrapper.getAttribute("data-pf-token"),this.vaultedId=this.parentCreditCardWrapper.getAttribute("data-vaulted-shopper-id"),this.securedFirstName=this.parentCreditCardWrapper.getAttribute("data-secured-firstName"),this.securedLastName=this.parentCreditCardWrapper.getAttribute("data-secured-lastName"),this.securedAmount=this.parentCreditCardWrapper.getAttribute("data-secured-amount"),this.securedCurrency=this.parentCreditCardWrapper.getAttribute("data-secured-currency"),this.shopperCardTyp=this.parentCreditCardWrapper.getAttribute("data-card-type"),this.cardNumberDom=document.getElementById("bluesnap-card-number"),this.cardHolderDom=document.getElementById("bluesnap-card-holder"),this.cardHolderDomLastName=document.getElementById("bluesnap-card-holder-lastname"),this.saveCardCheckbox=document.getElementById("bluesnap-is-save-card"),this.savedCardForm=document.getElementById("bluesnap-saved-card-form"),this.checkoutForm=document.getElementById("bluesnap-checkout-form"),this.firstName=document.getElementById("bluesnap-first-name").value,this.lastName=document.getElementById("bluesnap-last-name").value,this.saveCard=((e=document.getElementById("bluesnap-save-card"))===null||void 0===e?void 0:e.checked)||null,this.threeDS=!!this.parentCreditCardWrapper.getAttribute("data-three-d-secure"),this.cardUrl={AMEX:"https://files.readme.io/97e7acc-Amex.png",DINERS:"https://files.readme.io/8c73810-Diners_Club.png",DISCOVER:"https://files.readme.io/caea86d-Discover.png",JCB:"https://files.readme.io/e076aed-JCB.png",MASTERCARD:"https://files.readme.io/5b7b3de-Mastercard.png",VISA:"https://files.readme.io/9018c4f-Visa.png"},this.threeDSecureObj={amount:parseFloat(this.securedAmount),currency:this.securedCurrency,billingFirstName:this.securedFirstName,billingLastName:this.securedLastName},this.blueSnapObject={"3DS":this.threeDS,token:this.pfToken,onFieldEventHandler:{onFocus:e=>{this._changeImpactedElement(e,"hosted-field-valid hosted-field-invalid","hosted-field-focus")},onBlur:e=>{this._changeImpactedElement(e,"hosted-field-focus")},onError:(e,t,a,r)=>{this._changeImpactedElement(e,"hosted-field-valid hosted-field-focus","hosted-field-invalid");let n=document.getElementById(e+"-help");n&&(n.classList.remove("helper-text-green"),n.textContent=t+" - "+a+" - "+r)},onType:(e,t,a)=>{let r=document.querySelector("#card-logo > img");if(r&&(r.src=this.cardUrl[t]),a){let t=document.getElementById(e+"-help");t&&(t.classList.add("helper-text-green"),t.textContent=JSON.stringify(a))}},onValid:e=>{this._changeImpactedElement(e,"hosted-field-focus hosted-field-invalid","hosted-field-valid");let t=document.getElementById(e+"-help");t&&(t.textContent="")}},style:{input:{"font-size":"14px","font-family":"Helvetica Neue,Helvetica,Arial,sans-serif","line-height":"1.42857143",color:"#555"},":focus":{color:"#555"}},ccnPlaceHolder:"Card number*",cvvPlaceHolder:"CVV*",expPlaceHolder:"MM / YY*"},bluesnap.hostedPaymentFieldsCreate(this.blueSnapObject)}_registerEvents(){this.confirmOrderForm.addEventListener("click",this._onOrderSubmitButtonClick.bind(this)),this.saveCardCheckbox&&this.saveCardCheckbox.addEventListener("change",()=>this._showForm())}async _showForm(){let e=this.saveCardCheckbox.checked;if(this.savedCardForm.classList.toggle("d-none",!e),this.checkoutForm.classList.toggle("d-none",e),e){let e=this.parentCreditCardWrapper.getAttribute("data-shopper-name"),t=this.parentCreditCardWrapper.getAttribute("data-shopper-lastName"),a=this.parentCreditCardWrapper.getAttribute("data-shopper-last-digits");this.cardNumberDom.innerText="**** **** **** ".concat(a),this.cardHolderDom.innerText=e,this.cardHolderDomLastName.innerText=t}}async _updateVaultedShopperCard(){this.cardNumberDom=document.getElementById("bluesnap-card-number"),this.cardHolderDom=document.getElementById("bluesnap-card-holder");let t={pfToken:document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),firstName:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-name"),lastName:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-lastName"),cardType:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-card-type"),cardLastFourDigits:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-last-digits")},a=await e.updateVaultedShopper(this.vaultedId,t);a.success||console.error("Failed to update vaulted shopper:",a.message)}_creditCardCapture(){bluesnap.hostedPaymentFieldsSubmitData(async t=>{var a,r,n,s,d,o;if(null!=t.error){let e=document.getElementById("error-message");e.style.display="none";let a=t.error,r=[];for(let e in a){let t=a[e];r.push("".concat(t.errorCode,": ").concat(t.errorDescription))}e.innerHTML=r.join("<br/>"),e.style.display="block";return}if(!0===this.threeDS&&(null==t.threeDSecure||"AUTHENTICATION_SUCCEEDED"!==t.threeDSecure.authResult)&&((d=t.threeDSecure)===null||void 0===d?void 0:d.authResult)==="AUTHENTICATION_UNAVAILABLE"){document.getElementById("bluesnap-loader").style.display="none",document.querySelector("#error-message .error-alert p").innerText="This card type does not support 3D Secure: ".concat(t.threeDSecure.authResult),document.getElementById("error-message").classList.remove("d-none"),document.getElementById("bluesnap-checkout-form").classList.remove("d-none");return}let i=((a=document.getElementById("bluesnap-save-card"))===null||void 0===a?void 0:a.checked)||null;this.vaultedId&&i&&await this._updateVaultedShopperCard();let l={pfToken:document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),firstName:document.getElementById("bluesnap-first-name").value,lastName:document.getElementById("bluesnap-last-name").value,saveCard:((r=document.getElementById("bluesnap-save-card"))===null||void 0===r?void 0:r.checked)||null,cardType:t.cardData.ccType,...!0===this.threeDS&&{threeDSecureReferenceId:(n=t.threeDSecure)===null||void 0===n?void 0:n.threeDSecureReferenceId,authResult:(s=t.threeDSecure)===null||void 0===s?void 0:s.authResult}};document.getElementById("bluesnap-checkout-form").classList.add("d-none"),document.getElementById("bluesnap-loader").style.display="block";let c=await e.capture(l);if(c&&c.success)document.getElementById("bluesnap-transaction-id").value=JSON.parse(c.message).transactionId,document.getElementById("confirmOrderForm").submit();else{let e=(o=JSON.parse(c.message)[0])===null||void 0===o?void 0:o.description;document.getElementById("bluesnap-loader").style.display="none",console.log(e),document.querySelector("#error-message .error-alert p").innerText=e.split("-")[0],document.getElementById("error-message").classList.remove("d-none"),document.getElementById("error-message").classList.add("block"),document.getElementById("bluesnap-checkout-form").classList.remove("d-none")}},this.threeDS?this.threeDSecureObj:void 0)}async _onOrderSubmitButtonClick(e){e.preventDefault(),document.getElementById("bluesnap-is-save-card").checked?await this._vaultedCapture():this._creditCardCapture()}async _vaultedCapture(){if(this.threeDS)bluesnap.threeDsPaymentsSetup(this.pfToken,async t=>{if(1==t.code){let a=t.threeDSecure,r={pfToken:document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),vaultedId:document.getElementById("bluesnap-credit-card").getAttribute("data-vaulted-shopper-id"),...!0===this.threeDS&&{threeDSecureReferenceId:null==a?void 0:a.threeDSecureReferenceId,authResult:null==a?void 0:a.authResult}},n=await e.vaultedShopper(r);if(n&&n.success){let e=JSON.parse(n.message);document.getElementById("bluesnap-transaction-id").value=e.transactionId,document.getElementById("confirmOrderForm").submit()}}else{let e=t.info.errors;document.querySelector("#error-message .error-alert p").innerText=t.info.errors,document.getElementById("error-message").classList.remove("d-none"),document.getElementById("error-message").classList.add("block"),t.info.warnings,console.log("errorsArray",e)}});else{let t=document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),a=document.getElementById("bluesnap-credit-card").getAttribute("data-vaulted-shopper-id");document.getElementById("bluesnap-saved-card-form").classList.add("d-none"),document.getElementById("bluesnap-loader").style.display="block";let r=await e.vaultedShopper({pfToken:t,vaultedId:a});if(r&&r.success){let e=JSON.parse(r.message);document.getElementById("bluesnap-transaction-id").value=e.transactionId,document.getElementById("confirmOrderForm").submit()}}let t={last4Digits:this.parentCreditCardWrapper.getAttribute("data-shopper-last-digits"),ccType:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-card-type"),amount:parseFloat(this.securedAmount),currency:this.securedCurrency};this.threeDS&&bluesnap.threeDsPaymentsSubmitData(t)}_changeImpactedElement(e,t,a){t=t||"",a=a||"";let r=document.querySelector('[data-bluesnap="'+e+'"]');a&&r.classList.add(...a.split(" ")),t&&r.classList.remove(...t.split(" "))}}t.options={confirmFormId:"confirmOrderForm",parentCreditCardWrapperId:"bluesnap-credit-card"};class a{loadScript(e){let t=document.createElement("script");t.src=this.cdnUrl,t.onload=()=>{console.log("Script loaded successfully"),e&&e()},t.onerror=()=>{console.error("Failed to load script")},document.body.appendChild(t)}constructor(e){this.cdnUrl=e}}class r extends window.PluginBaseClass{init(){new a("https://pay.google.com/gp/p/js/pay.js").loadScript(function(){let t={apiVersion:2,apiVersionMinor:0},a={type:"PAYMENT_GATEWAY",parameters:{gateway:"bluesnap",gatewayMerchantId:document.getElementById("bluesnap-google-pay").getAttribute("data-merchant-id")}},r={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:["AMEX","DISCOVER","INTERAC","JCB","MASTERCARD","VISA"]}},n=Object.assign({},r,{tokenizationSpecification:a}),s=null;function d(){let e=Object.assign({},t);return e.allowedPaymentMethods=[n],e.transactionInfo=i(),e.merchantInfo={merchantId:document.getElementById("bluesnap-google-pay").getAttribute("data-google-merchant-id"),merchantName:"Example Merchant"},e.emailRequired=!0,e.shippingAddressRequired=!0,e.shippingAddressParameters={phoneNumberRequired:!0},e}function o(){if(null===s){let e=document.getElementById("bluesnap-google-pay").getAttribute("data-mode");console.log(e),s=new google.payments.api.PaymentsClient({environment:"sandbox"===e?"TEST":"PRODUCTION"})}return s}function i(){return{countryCode:"US",currencyCode:document.getElementById("bluesnap-google-pay").getAttribute("data-currency-code"),totalPriceStatus:"FINAL",totalPrice:document.getElementById("bluesnap-google-pay").getAttribute("data-total-price")}}function l(){if(!document.getElementById("confirmOrderForm").checkValidity())return;let e=d();e.transactionInfo=i(),o().loadPaymentData(e).then(function(e){c(e)}).catch(function(e){console.error(e)})}async function c(t){console.log(t);let a=btoa(encodeURIComponent(JSON.stringify(t)).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)})),r=await e.googleCapture({gToken:a});console.log(r),r&&r.success&&(document.getElementById("bluesnap-transaction-id").value=JSON.parse(r.message).transactionId,document.getElementById("confirmOrderForm").submit())}o().isReadyToPay(Object.assign({},t,{allowedPaymentMethods:[r]})).then(function(e){e.result&&(function(){let e=o().createButton({onClick:l,allowedPaymentMethods:[r]});document.getElementById("container").appendChild(e)}(),function(){let e=d();e.transactionInfo={totalPriceStatus:"NOT_CURRENTLY_KNOWN",currencyCode:document.getElementById("bluesnap-google-pay").getAttribute("data-currency-code")},o().prefetchPaymentData(e)}())}).catch(function(e){console.error(e)})})}}class n extends window.PluginBaseClass{init(){this._registerElements(),this._registerEvents(),this._displayButton()}_applePayClicked(){console.log("applePayClicked");let t={countryCode:"US",currencyCode:"USD",supportedNetworks:["visa","masterCard","amex","discover"],merchantCapabilities:["supports3DS"],total:{label:"BlueSnap",amount:this.totalPrice}},a=new ApplePaySession(3,t);console.log("session",a),a.onvalidatemerchant=async t=>{let r={validationUrl:t.validationURL,domainName:this.domain,displayName:"BlueSnap"},n=await e.appleCreateWallet(r);n&&n.success||(console.log("abort"),a.abort());let s=JSON.parse(n.message);a.completeMerchantValidation(s)},a.onpaymentauthorized=async t=>{let r=btoa(JSON.stringify(t.payment));console.log("Encoded Payment Token:",r);let n=await e.appleCapture({appleToken:r});console.log("captureResult",n),a.completePayment(ApplePaySession.STATUS_SUCCESS),n&&n.success&&(document.getElementById("bluesnap-transaction-id").value=JSON.parse(n.message).transactionId,document.getElementById("confirmOrderForm").submit())},a.begin()}_registerElements(){this.appleButton=document.getElementById(this.options.appleButtonId),this.parentCreditCardWrapper=document.getElementById(this.options.parentWrapperId),this.form=document.getElementById(this.options.confirmFormId),this.totalPrice=this.parentCreditCardWrapper.getAttribute("data-total-price"),this.pfToken=this.parentCreditCardWrapper.getAttribute("data-pf-token"),this.merchantID=this.parentCreditCardWrapper.getAttribute("data-merchant-id"),this.domain=this.parentCreditCardWrapper.getAttribute("data-domain-name"),this.errorWrapper=document.getElementById(this.options.errorWrapperId)}_registerEvents(){this.appleButton.addEventListener("click",this._applePayClick.bind(this))}_applePayClick(e){e.preventDefault(),this.form.checkValidity()&&this._applePayClicked()}_displayButton(){if(!window.ApplePaySession||!ApplePaySession.canMakePayments()){this.errorWrapper.classList.remove("d-none"),console.log("cannotMakePayments");return}ApplePaySession.canMakePaymentsWithActiveCard(this.merchantID+"-"+this.domain).then(e=>{if(!e){this.errorWrapper.classList.remove("d-none"),console.log("cardNotActive");return}this.appleButton.classList.remove("visually-hidden")})}}n.options={confirmFormId:"confirmOrderForm",parentWrapperId:"bluesnap-apple-pay",appleButtonId:"apple-pay-button",errorWrapperId:"apple-pay-support-error"};let s=window.PluginManager;s.register("BluesnapCreditCardPlugin",t,"[data-bluesnap-credit-card]"),s.register("BluesnapGooglePayPlugin",r,"[data-bluesnap-google-pay]"),s.register("BluesnapApplePayPlugin",n,"[data-bluesnap-apple-pay]")})();