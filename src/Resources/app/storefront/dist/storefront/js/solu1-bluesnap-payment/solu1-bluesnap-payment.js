(()=>{"use strict";let e=new class{async _makeRequest(e,t,a){let r=new Headers;r.append("Content-Type","application/json");let n={method:t,headers:r};a&&(n.body=JSON.stringify(a));try{let t=await fetch(e,n);return await t.json()}catch(e){console.error(JSON.stringify(e,null,2))}}constructor(){this.endpoints={capture:async e=>await this._makeRequest("/capture","POST",e),googleCapture:async e=>await this._makeRequest("/google-capture","POST",e),appleCreateWallet:async e=>await this._makeRequest("/apple-create-wallet","POST",e),appleCapture:async e=>await this._makeRequest("/apple-capture","POST",e),vaultedShopper:async e=>await this._makeRequest("/vaulted-shopper","POST",e),updateVaultedShopper:async(e,t)=>await this._makeRequest("/update-vaulted-shopper/"+e,"PUT",t)}}}().endpoints;class t{constructor(e){this.cdnUrl=e}loadScript(e){let t=document.createElement("script");t.src=this.cdnUrl,t.onload=()=>{e&&e()},t.onerror=()=>{console.error("Failed to load script")},document.body.appendChild(t)}}class a extends window.PluginBaseClass{static #e=this.options={confirmFormId:"confirmOrderForm",parentCreditCardWrapperId:"bluesnap-credit-card"};init(){new t(document.getElementById("bluesnap-credit-card").getAttribute("data-script-url")).loadScript(()=>{this._registerElements(),this._registerEvents(),this._showForm()})}_registerElements(){this.confirmOrderForm=document.forms[this.options.confirmFormId],this.parentCreditCardWrapper=document.getElementById(this.options.parentCreditCardWrapperId),this.pfToken=this.parentCreditCardWrapper.getAttribute("data-pf-token"),this.vaultedId=this.parentCreditCardWrapper.getAttribute("data-vaulted-shopper-id"),this.securedFirstName=this.parentCreditCardWrapper.getAttribute("data-secured-firstName"),this.securedLastName=this.parentCreditCardWrapper.getAttribute("data-secured-lastName"),this.securedAmount=this.parentCreditCardWrapper.getAttribute("data-secured-amount"),this.securedCurrency=this.parentCreditCardWrapper.getAttribute("data-secured-currency"),this.cardNumberDom=document.getElementById("bluesnap-card-number"),this.cardHolderDom=document.getElementById("bluesnap-card-holder"),this.cardHolderDomLastName=document.getElementById("bluesnap-card-holder-lastname"),this.saveCardCheckbox=document.getElementById("bluesnap-is-save-card"),this.savedCardForm=document.getElementById("bluesnap-saved-card-form"),this.checkoutForm=document.getElementById("bluesnap-checkout-form"),this.firstName=document.getElementById("bluesnap-first-name").value,this.lastName=document.getElementById("bluesnap-last-name").value,this.saveCard=document.getElementById("bluesnap-save-card")?.checked||null,this.threeDS=!!this.parentCreditCardWrapper.getAttribute("data-three-d-secure"),this.errorMessage=document.getElementById("error-message"),this.cardUrl={AMEX:"https://files.readme.io/97e7acc-Amex.png",DINERS:"https://files.readme.io/8c73810-Diners_Club.png",DISCOVER:"https://files.readme.io/caea86d-Discover.png",JCB:"https://files.readme.io/e076aed-JCB.png",MASTERCARD:"https://files.readme.io/5b7b3de-Mastercard.png",VISA:"https://files.readme.io/9018c4f-Visa.png"},this.threeDSecureObj={amount:parseFloat(this.securedAmount),currency:this.securedCurrency,billingFirstName:this.securedFirstName,billingLastName:this.securedLastName},this.blueSnapObject={"3DS":this.threeDS,token:this.pfToken,onFieldEventHandler:{onFocus:e=>{this._changeImpactedElement(e,"hosted-field-valid hosted-field-invalid","hosted-field-focus")},onBlur:e=>{this._changeImpactedElement(e,"hosted-field-focus")},onError:(e,t,a,r)=>{this._changeImpactedElement(e,"hosted-field-valid hosted-field-focus","hosted-field-invalid");let n=document.getElementById(e+"-help");n&&(n.classList.remove("helper-text-green"),n.textContent=t+" - "+a+" - "+r)},onType:(e,t,a)=>{let r=document.querySelector("#card-logo > img");if(r&&(r.src=this.cardUrl[t]),a){let t=document.getElementById(e+"-help");t&&(t.classList.add("helper-text-green"),t.textContent=JSON.stringify(a))}},onValid:e=>{this._changeImpactedElement(e,"hosted-field-focus hosted-field-invalid","hosted-field-valid");let t=document.getElementById(e+"-help");t&&(t.textContent="")}},style:{input:{"font-size":"14px","font-family":"Helvetica Neue,Helvetica,Arial,sans-serif","line-height":"1.42857143",color:"#555"},":focus":{color:"#555"}},ccnPlaceHolder:"Card number*",cvvPlaceHolder:"CVV*",expPlaceHolder:"MM / YY*"},bluesnap.hostedPaymentFieldsCreate(this.blueSnapObject)}_scrollToBluesnapSection(){this.parentCreditCardWrapper.scrollIntoView({behavior:"smooth",block:"center"})}_registerEvents(){this.confirmOrderForm.addEventListener("click",this._onOrderSubmitButtonClick.bind(this)),this.saveCardCheckbox&&this.saveCardCheckbox.addEventListener("change",()=>this._showForm())}_showForm(){let e=this.saveCardCheckbox.checked;if(this.savedCardForm.classList.toggle("d-none",!e),this.checkoutForm.classList.toggle("d-none",e),e){let e=this.parentCreditCardWrapper.getAttribute("data-shopper-name"),t=this.parentCreditCardWrapper.getAttribute("data-shopper-lastName"),a=this.parentCreditCardWrapper.getAttribute("data-shopper-last-digits");this.cardNumberDom.innerText=`**** **** **** ${a}`,this.cardHolderDom.innerText=e,this.cardHolderDomLastName.innerText=t}}async _updateVaultedShopperCard(){this.cardNumberDom=document.getElementById("bluesnap-card-number"),this.cardHolderDom=document.getElementById("bluesnap-card-holder");let t={pfToken:document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),firstName:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-name"),lastName:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-lastName"),cardType:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-card-type"),cardLastFourDigits:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-last-digits")},a=await e.updateVaultedShopper(this.vaultedId,t);a.success||console.error("Failed to update vaulted shopper:",a.message)}_creditCardCapture(){this._validateBluesnapFields()&&bluesnap.hostedPaymentFieldsSubmitData(async t=>{if(null!=t.error){let e=document.getElementById("error-message");e.style.display="none";let a=t.error,r=[];for(let e in a){let t=a[e];r.push(`${t.errorCode}: ${t.errorDescription}`)}e.innerHTML=r.join("<br/>"),e.style.display="block",this._scrollToBluesnapSection();return}if(!0===this.threeDS&&(null==t.threeDSecure||"AUTHENTICATION_SUCCEEDED"!==t.threeDSecure.authResult)&&t.threeDSecure?.authResult==="AUTHENTICATION_UNAVAILABLE"){document.getElementById("bluesnap-loader").style.display="none",document.querySelector("#error-message .error-alert p").innerText=`This card type does not support 3D Secure: ${t.threeDSecure.authResult}`,document.getElementById("error-message").classList.remove("d-none"),document.getElementById("bluesnap-checkout-form").classList.remove("d-none"),this._scrollToBluesnapSection();return}let a=document.getElementById("bluesnap-save-card")?.checked||null;this.vaultedId&&a&&await this._updateVaultedShopperCard();let r={pfToken:document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),firstName:document.getElementById("bluesnap-first-name").value,lastName:document.getElementById("bluesnap-last-name").value,saveCard:document.getElementById("bluesnap-save-card")?.checked||null,cardType:t.cardData.ccType,...!0===this.threeDS&&{threeDSecureReferenceId:t.threeDSecure?.threeDSecureReferenceId,authResult:t.threeDSecure?.authResult}};if(document.getElementById("bluesnap-checkout-form").classList.add("d-none"),document.getElementById("bluesnap-loader").style.display="block",this._scrollToBluesnapSection(),"order_payment"===document.getElementById("bluesnap-credit-card").getAttribute("data-flow"))document.getElementById("paymentData").value=JSON.stringify(r),document.getElementById("confirmOrderForm").submit();else{let t=await e.capture(r);if(t&&t.success)document.getElementById("solu1-bluesnap-transaction-id").value=JSON.parse(t.message).transactionId,document.getElementById("confirmOrderForm").submit();else{let e=JSON.parse(t.message),a=e[0]?.description;document.getElementById("bluesnap-loader").style.display="none",document.querySelector("#error-message .error-alert p").innerText=a.split("-")[0],document.getElementById("error-message").classList.remove("d-none"),document.getElementById("error-message").classList.add("block"),document.getElementById("bluesnap-checkout-form").classList.remove("d-none")}}},this.threeDS?this.threeDSecureObj:void 0)}async _onOrderSubmitButtonClick(e){if(e.preventDefault(),this.saveCardCheckbox&&(this.saveCardCheckbox.disabled=!0),!this.confirmOrderForm.checkValidity()){this.confirmOrderForm.reportValidity();return}this._scrollToBluesnapSection(),document.getElementById("bluesnap-is-save-card").checked?await this._vaultedCapture():this._creditCardCapture()}async _vaultedCapture(){if(this.threeDS)bluesnap.threeDsPaymentsSetup(this.pfToken,async t=>{if(1==t.code){let a=t.threeDSecure,r={pfToken:document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),vaultedId:document.getElementById("bluesnap-credit-card").getAttribute("data-vaulted-shopper-id"),...!0===this.threeDS&&{threeDSecureReferenceId:a?.threeDSecureReferenceId,authResult:a?.authResult}};document.getElementById("bluesnap-saved-card-form").classList.add("d-none"),document.getElementById("bluesnap-loader").style.display="block",this._scrollToBluesnapSection();let n=await e.vaultedShopper(r);if(n&&n.success){let e=JSON.parse(n.message);document.getElementById("solu1-bluesnap-transaction-id").value=e.transactionId,document.getElementById("confirmOrderForm").submit()}}else t.info.errors,document.querySelector("#error-message .error-alert p").innerText=t.info.errors,document.getElementById("error-message").classList.remove("d-none"),document.getElementById("error-message").classList.add("block"),this._scrollToBluesnapSection()});else{let t={pfToken:document.getElementById("bluesnap-credit-card").getAttribute("data-pf-token"),vaultedId:document.getElementById("bluesnap-credit-card").getAttribute("data-vaulted-shopper-id")};if(document.getElementById("bluesnap-saved-card-form").classList.add("d-none"),document.getElementById("bluesnap-loader").style.display="block",this._scrollToBluesnapSection(),"order_payment"===document.getElementById("bluesnap-credit-card").getAttribute("data-flow"))document.getElementById("paymentData").value=JSON.stringify(t),document.getElementById("confirmOrderForm").submit();else{let a=await e.vaultedShopper(t);if(a&&a.success){let e=JSON.parse(a.message);document.getElementById("solu1-bluesnap-transaction-id").value=e.transactionId,document.getElementById("confirmOrderForm").submit()}}}let t={last4Digits:this.parentCreditCardWrapper.getAttribute("data-shopper-last-digits"),ccType:document.getElementById("bluesnap-credit-card").getAttribute("data-shopper-card-type"),amount:parseFloat(this.securedAmount),currency:this.securedCurrency};this.threeDS&&bluesnap.threeDsPaymentsSubmitData(t)}_changeImpactedElement(e,t,a){t=t||"",a=a||"";let r=document.querySelector('[data-bluesnap="'+e+'"]');a&&r.classList.add(...a.split(" ")),t&&r.classList.remove(...t.split(" "))}_validateBluesnapFields(){let e=!0;return[{id:"bluesnap-first-name",name:"First name"},{id:"bluesnap-last-name",name:"Last name"}].forEach(t=>{let a=document.getElementById(t.id);a&&""!==a.value.trim()?a.classList.remove("is-invalid"):(a.classList.add("is-invalid"),e=!1)}),e?this.errorMessage.classList.add("d-none"):(this.errorMessage.querySelector("p").innerText="Please fill in all required fields.",this.errorMessage.classList.remove("d-none"),this._scrollToBluesnapSection()),e}}class r extends window.PluginBaseClass{init(){new t("https://pay.google.com/gp/p/js/pay.js").loadScript(function(){let t={apiVersion:2,apiVersionMinor:0},a={type:"PAYMENT_GATEWAY",parameters:{gateway:"bluesnap",gatewayMerchantId:document.getElementById("bluesnap-google-pay").getAttribute("data-merchant-id")}},r={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:["AMEX","DISCOVER","INTERAC","JCB","MASTERCARD","VISA"]}},n=Object.assign({},r,{tokenizationSpecification:a}),s=null;function d(){let e=Object.assign({},t);return e.allowedPaymentMethods=[n],e.transactionInfo=o(),e.merchantInfo={merchantId:document.getElementById("bluesnap-google-pay").getAttribute("data-google-merchant-id"),merchantName:"Example Merchant"},e.emailRequired=!0,e.shippingAddressRequired=!0,e.shippingAddressParameters={phoneNumberRequired:!0},e}function i(){if(null===s){let e=document.getElementById("bluesnap-google-pay").getAttribute("data-mode");s=new google.payments.api.PaymentsClient({environment:"sandbox"===e?"TEST":"PRODUCTION"})}return s}function o(){return{countryCode:"US",currencyCode:document.getElementById("bluesnap-google-pay").getAttribute("data-currency-code"),totalPriceStatus:"FINAL",totalPrice:document.getElementById("bluesnap-google-pay").getAttribute("data-total-price")}}function l(){if(!document.getElementById("confirmOrderForm").checkValidity())return;let e=d();e.transactionInfo=o(),i().loadPaymentData(e).then(function(e){c(e)}).catch(function(e){console.error(e)})}async function c(t){let a=t.paymentMethodData,r=a.info||{},n={paymentMethodData:{description:a.description||"",tokenizationData:{type:a.tokenizationData.type,token:a.tokenizationData.token},info:{cardNetwork:r.cardNetwork,cardDetails:r.cardDetails}},email:t.email||null,googleTransactionId:t.googleTransactionId||null,shippingAddress:t.shippingAddress||null};Object.keys(n).forEach(e=>{null===n[e]&&delete n[e]});let s=btoa(encodeURIComponent(JSON.stringify(n)).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)})),d=document.getElementById("bluesnap-google-pay").getAttribute("data-flow"),i={gToken:s,email:t.email};if("order_payment"===d)document.getElementById("paymentData").value=JSON.stringify(i),document.getElementById("confirmOrderForm").submit();else{let t=await e.googleCapture(i);t&&t.success&&(document.getElementById("solu1-bluesnap-transaction-id").value=JSON.parse(t.message).transactionId,document.getElementById("confirmOrderForm").submit())}}i().isReadyToPay(Object.assign({},t,{allowedPaymentMethods:[r]})).then(function(e){e.result&&(function(){let e=i().createButton({onClick:l,allowedPaymentMethods:[r]});document.getElementById("container").appendChild(e)}(),function(){let e=d();e.transactionInfo={totalPriceStatus:"NOT_CURRENTLY_KNOWN",currencyCode:document.getElementById("bluesnap-google-pay").getAttribute("data-currency-code")},i().prefetchPaymentData(e)}())}).catch(function(e){console.error(e)})})}}class n extends window.PluginBaseClass{static #e=this.options={confirmFormId:"confirmOrderForm",parentWrapperId:"bluesnap-apple-pay",appleButtonId:"apple-pay-button",errorWrapperId:"apple-pay-support-error"};init(){this._registerElements(),this._registerEvents(),this._displayButton()}_applePayClicked(){let t=new ApplePaySession(14,{countryCode:"US",currencyCode:"USD",supportedNetworks:["visa","masterCard","amex","discover"],merchantCapabilities:["supports3DS"],total:{label:"solu1BluesnapPayment",amount:this.totalPrice}});t.onvalidatemerchant=async a=>{let r={validationUrl:a.validationURL,domainName:this.domain,displayName:"solu1BluesnapPayment"},n=await e.appleCreateWallet(r);n&&n.success||t.abort();let s=JSON.parse(n.message);t.completeMerchantValidation(s)},t.onpaymentauthorized=async a=>{let r={appleToken:btoa(JSON.stringify(a.payment)),email:this.userEmail},n=document.getElementById("bluesnap-google-pay").getAttribute("data-flow");if(t.completePayment(ApplePaySession.STATUS_SUCCESS),"order_payment"===n){let t=await e.appleCapture(r);t&&t.success&&(document.getElementById("solu1-bluesnap-transaction-id").value=JSON.parse(t.message).transactionId,document.getElementById("confirmOrderForm").submit())}else document.getElementById("paymentData").value=JSON.stringify(r),document.getElementById("confirmOrderForm").submit()},t.begin()}_registerElements(){this.appleButton=document.getElementById(this.options.appleButtonId),this.parentCreditCardWrapper=document.getElementById(this.options.parentWrapperId),this.form=document.getElementById(this.options.confirmFormId),this.totalPrice=this.parentCreditCardWrapper.getAttribute("data-total-price"),this.userEmail=this.parentCreditCardWrapper.getAttribute(" data-user-email"),this.pfToken=this.parentCreditCardWrapper.getAttribute("data-pf-token"),this.merchantID=this.parentCreditCardWrapper.getAttribute("data-merchant-id"),this.domain=this.parentCreditCardWrapper.getAttribute("data-domain-name"),this.errorWrapper=document.getElementById(this.options.errorWrapperId)}_registerEvents(){this.appleButton.addEventListener("click",this._applePayClick.bind(this))}_applePayClick(e){e.preventDefault(),this.form.checkValidity()&&this._applePayClicked()}_displayButton(){if(!window.ApplePaySession||!window.ApplePaySession.canMakePayments()){this.errorWrapper.classList.remove("d-none");return}window.ApplePaySession.canMakePaymentsWithActiveCard(this.merchantID+"-"+this.domain).then(e=>{if(!e){this.errorWrapper.classList.remove("d-none");return}this.appleButton.classList.remove("visually-hidden")})}}let s=window.PluginManager;s.register("BluesnapCreditCardPlugin",a,"[data-bluesnap-credit-card]"),s.register("BluesnapGooglePayPlugin",r,"[data-bluesnap-google-pay]"),s.register("BluesnapApplePayPlugin",n,"[data-bluesnap-apple-pay]")})();